<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Uploading code - NodeMCU Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Uploading code";
    var mkdocs_page_input_path = "en/upload.md";
    var mkdocs_page_url = "/en/upload/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> NodeMCU Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		

  <a class="" href="../..">Overview</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../">Home</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../build/">Building the firmware</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../flash/">Flashing the firmware</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../spiffs/">Internal filesystem notes</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../sdcard/">Filesystem on SD card</a>
	    </li>
          
            <li class="toctree-l1 current">
		

  <a class="current" href="./">Uploading code</a>
  <ul class="subnav">
      
  
    <li class="toctree-l2"><a href="#tools">Tools</a></li>
  
  
    <ul class="">
    
        <li class="toctree-l3" >
          <a class="toctree-l3" href="#esplorer">ESPlorer</a>
        </li>
    
        <li class="toctree-l3" >
          <a class="toctree-l3" href="#nodemcu-uploaderpy">nodemcu-uploader.py</a>
        </li>
    
        <li class="toctree-l3" >
          <a class="toctree-l3" href="#nodemcu-tool">NodeMCU-Tool</a>
        </li>
    
    </ul>
  

  
    <li class="toctree-l2"><a href="#initlua">init.lua</a></li>
  
  

  
    <li class="toctree-l2"><a href="#compiling-lua-on-your-pc-for-uploading">Compiling Lua on your PC for Uploading</a></li>
  
  

  </ul>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="/en/lua-developer-faq">FAQs</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="../support/">Support</a>
	    </li>
          
            <li class="toctree-l1">
		

  <a class="" href="/en/modules/adc">Modules</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">NodeMCU Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Uploading code</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/nodemcu/nodemcu-firmware/edit/master/docs/en/upload.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>As with <a href="../flash/">flashing</a> there are several ways to upload code from your computer to the device.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The NodeMCU serial interface uses 115'200bps at boot time. To change the speed after booting, issue <code>uart.setup(0,9600,8,0,1,1)</code>. If the device panics and resets at any time, errors will be written to the serial interface at 115'200 bps.</p>
</div>
<h1 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h1>
<p>Transferring application code to ESP8266/8285 is an essential task, one that you'll perform quite frequently. Hence, it does make sense to try a few different uploading tools until you find one you feel comfortable with. <a href="https://frightanic.com/iot/tools-ides-nodemcu/">https://frightanic.com/iot/tools-ides-nodemcu/</a> lists almost a dozen classical uploaders - in addition to IDEs or IDE-like applications which of course transfer code as well.</p>
<p>The NodeMCU firmware team does not give any recommendations as for which uploader to use nor are there any "NodeMCU approved" tools. The below listed tools are just three, in no particular order, which seem popular and/or reasonably well maintained.</p>
<h2 id="esplorer">ESPlorer<a class="headerlink" href="#esplorer" title="Permanent link">&para;</a></h2>
<blockquote>
<p>The essential multiplatforms tools for any ESP8266 developer from luatool authorâ€™s, including Lua for NodeMCU and MicroPython. Also, all AT commands are supported. Requires Java (Standard Edition - SE ver 7 and above) installed.</p>
</blockquote>
<p><img alt="ESPlorer" src="../../img/ESPlorer.jpg" title="ESPlorer" /></p>
<p>Source: <a href="https://github.com/4refr0nt/ESPlorer">https://github.com/4refr0nt/ESPlorer</a></p>
<p>Supported platforms: macOS, Linux, Windows, anything that runs Java</p>
<h2 id="nodemcu-uploaderpy">nodemcu-uploader.py<a class="headerlink" href="#nodemcu-uploaderpy" title="Permanent link">&para;</a></h2>
<blockquote>
<p>A simple tool for uploading files to the filesystem of an ESP8266 running NodeMCU as well as some other useful commands.</p>
</blockquote>
<p>Source: <a href="https://github.com/kmpm/nodemcu-uploader">https://github.com/kmpm/nodemcu-uploader</a></p>
<p>Supported platforms: macOS, Linux, Windows, anything that runs Python</p>
<h2 id="nodemcu-tool">NodeMCU-Tool<a class="headerlink" href="#nodemcu-tool" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Upload/Download Lua files to your ESP8266 module with NodeMCU firmware.
Simple. Command Line. Cross-Platform. File Management. NodeMCU.</p>
</blockquote>
<p>Source: <a href="https://github.com/andidittrich/NodeMCU-Tool">https://github.com/andidittrich/NodeMCU-Tool</a></p>
<p>Supported platforms: macOS, Linux Windows, anything that runs Node.js</p>
<h1 id="initlua">init.lua<a class="headerlink" href="#initlua" title="Permanent link">&para;</a></h1>
<p>You will see "lua: cannot open init.lua" printed to the serial console when the device boots after it's been freshly flashed. If NodeMCU finds a <code>init.lua</code> in the root of the file system it will execute it as part of the boot sequence (standard Lua feature). Hence, your application is initialized and triggered from <code>init.lua</code>. Usually you first set up the WiFi connection and only continue once that has been successful.</p>
<p>Be very careful not to lock yourself out! If there's a bug in your <code>init.lua</code> you may be stuck in an infinite reboot loop. It is, therefore, advisable to build a small delay into your startup sequence that would allow you to interrupt the sequence by e.g. deleting or renaming <code>init.lua</code> (see also <a href="../lua-developer-faq/#how-do-i-avoid-a-panic-loop-in-initlua">FAQ</a>). Your <code>init.lua</code> is most likely going to be different than the one below but it's a good starting point for customizations:</p>
<pre><code class="lua">-- load credentials, 'SSID' and 'PASSWORD' declared and initialize in there
dofile(&quot;credentials.lua&quot;)

function startup()
    if file.open(&quot;init.lua&quot;) == nil then
        print(&quot;init.lua deleted or renamed&quot;)
    else
        print(&quot;Running&quot;)
        file.close(&quot;init.lua&quot;)
        -- the actual application is stored in 'application.lua'
        -- dofile(&quot;application.lua&quot;)
    end
end

-- Define WiFi station event callbacks 
wifi_connect_event = function(T) 
  print(&quot;Connection to AP(&quot;..T.SSID..&quot;) established!&quot;)
  print(&quot;Waiting for IP address...&quot;)
  if disconnect_ct ~= nil then disconnect_ct = nil end  
end

wifi_got_ip_event = function(T) 
  -- Note: Having an IP address does not mean there is internet access!
  -- Internet connectivity can be determined with net.dns.resolve().    
  print(&quot;Wifi connection is ready! IP address is: &quot;..T.IP)
  print(&quot;Startup will resume momentarily, you have 3 seconds to abort.&quot;)
  print(&quot;Waiting...&quot;) 
  tmr.create():alarm(3000, tmr.ALARM_SINGLE, startup)
end

wifi_disconnect_event = function(T)
  if T.reason == wifi.eventmon.reason.ASSOC_LEAVE then 
    --the station has disassociated from a previously connected AP
    return 
  end
  -- total_tries: how many times the station will attempt to connect to the AP. Should consider AP reboot duration.
  local total_tries = 75
  print(&quot;\nWiFi connection to AP(&quot;..T.SSID..&quot;) has failed!&quot;)

  --There are many possible disconnect reasons, the following iterates through 
  --the list and returns the string corresponding to the disconnect reason.
  for key,val in pairs(wifi.eventmon.reason) do
    if val == T.reason then
      print(&quot;Disconnect reason: &quot;..val..&quot;(&quot;..key..&quot;)&quot;)
      break
    end
  end

  if disconnect_ct == nil then 
    disconnect_ct = 1 
  else
    disconnect_ct = disconnect_ct + 1 
  end
  if disconnect_ct &lt; total_tries then 
    print(&quot;Retrying connection...(attempt &quot;..(disconnect_ct+1)..&quot; of &quot;..total_tries..&quot;)&quot;)
  else
    wifi.sta.disconnect()
    print(&quot;Aborting connection to AP!&quot;)
    disconnect_ct = nil  
  end
end

-- Register WiFi Station event callbacks
wifi.eventmon.register(wifi.eventmon.STA_CONNECTED, wifi_connect_event)
wifi.eventmon.register(wifi.eventmon.STA_GOT_IP, wifi_got_ip_event)
wifi.eventmon.register(wifi.eventmon.STA_DISCONNECTED, wifi_disconnect_event)

print(&quot;Connecting to WiFi access point...&quot;)
wifi.setmode(wifi.STATION)
wifi.sta.config({ssid=SSID, pwd=PASSWORD})
-- wifi.sta.connect() not necessary because config() uses auto-connect=true by default

</code></pre>

<h1 id="compiling-lua-on-your-pc-for-uploading">Compiling Lua on your PC for Uploading<a class="headerlink" href="#compiling-lua-on-your-pc-for-uploading" title="Permanent link">&para;</a></h1>
<p>If you install <code>lua</code> on your development PC or Laptop then you can use the standard Lua
compiler to syntax check any Lua source before downloading it to the ESP8266 module.  However,
the NodeMCU compiler output uses different data types (e.g. it supports ROMtables) so the
compiled output cannot run on the ESP8266.  </p>
<p>Compiling source on one platform for use on another (e.g. Intel x38 Window to ESP8266) is 
known as <em>cross-compilation</em> and the NodeMCU firmware supports the compilation of <code>luac.cross</code> 
on *nix patforms which have Lua 5.1, the Lua filesystem module (lfs), and the essential
GCC tools. Simply change directory to the firmware root directoy and run the command:</p>
<pre><code>lua tools/cross-lua.lua
</code></pre>
<p>This will generate a <code>luac.cross</code> executable in your root directory which can be used to
compile and to syntax-check Lua source on the Development machine for execution under 
NodeMCU Lua on the ESP8266. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../lua-developer-faq/" class="btn btn-neutral float-right" title="Lua Developer FAQ">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../sdcard/" class="btn btn-neutral" title="Filesystem on SD card"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/nodemcu/nodemcu-firmware/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../sdcard/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../lua-developer-faq/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../js/extra.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
